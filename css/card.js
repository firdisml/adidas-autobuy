let ccNumberInputOldValue,ccNumberInputOldCursor,ccNumberInput=document.querySelector(".cc-number-input"),ccNumberPattern=/^\d{0,16}$/g,ccNumberSeparator=" ",mask=(e,c,t)=>{var u=[];for(let r=0;r<e.length;r++)0!==r&&r%c==0&&u.push(t),u.push(e[r]);return u.join("")},unmask=e=>e.replace(/[^\d]/g,""),checkSeparator=(e,c)=>Math.floor(e/(c+1)),ccNumberInputKeyDownHandler=e=>{let c=e.target;ccNumberInputOldValue=c.value,ccNumberInputOldCursor=c.selectionEnd},ccNumberInputInputHandler=e=>{console.log("Input Event");let c,t=e.target,u=unmask(t.value);u.match(ccNumberPattern)?(u=mask(u,4,ccNumberSeparator),c=ccNumberInputOldCursor-checkSeparator(ccNumberInputOldCursor,4)+checkSeparator(ccNumberInputOldCursor+(u.length-ccNumberInputOldValue.length),4)+(unmask(u).length-unmask(ccNumberInputOldValue).length),t.value=""!==u?u:""):(t.value=ccNumberInputOldValue,c=ccNumberInputOldCursor),t.setSelectionRange(c,c),highlightCC(t.value)},highlightCC=e=>{let c="",t={amex:/^3/,visa:/^4/,mastercard:/^5/,disc:/^6/,genric:/(^1|^2|^7|^8|^9|^0)/};for(const u in t)if(t[u].test(e)){c=u;break}let u=document.querySelector(".cc-types__img--active"),r=document.querySelector(`.cc-types__img--${c}`);u&&u.classList.remove("cc-types__img--active"),r&&r.classList.add("cc-types__img--active")};ccNumberInput.addEventListener("keydown",ccNumberInputKeyDownHandler),ccNumberInput.addEventListener("input",ccNumberInputInputHandler),ccNumberInput.addEventListener("click",()=>{card=$(document).find(".cc-number-input"),newValue=card.val(),newValue.match(ccNumberPattern)&&(highlightCC(newValue),newValue=mask(card.val(),4,ccNumberSeparator),card.val(newValue))});